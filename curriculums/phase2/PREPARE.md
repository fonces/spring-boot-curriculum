# Phase 2 äº‹å‰æº–å‚™: Docker Composeã§MySQLç’°å¢ƒæ§‹ç¯‰

## ðŸŽ¯ ã“ã®äº‹å‰æº–å‚™ã®ç›®æ¨™

Phase 2ã§ã¯ã€Spring Bootã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨MySQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é€£æºã•ã›ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚ãã®ãŸã‚ã«ã€Docker Composeã‚’ä½¿ã£ã¦MySQLç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

- Docker Desktopã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨èµ·å‹•ç¢ºèªãŒã§ãã‚‹
- Docker Composeã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’ç†è§£ã§ãã‚‹
- `docker-compose.yml`ã‚’ä½œæˆã—ã¦MySQLç’°å¢ƒã‚’æ§‹ç¯‰ã§ãã‚‹
- MySQLã‚³ãƒ³ãƒ†ãƒŠã«æŽ¥ç¶šã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œãŒã§ãã‚‹

**æ‰€è¦æ™‚é–“**: ç´„30åˆ†

---

## ðŸ“‹ å‰ææ¡ä»¶

- Phase 1ãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨
- ã‚¿ãƒ¼ãƒŸãƒŠãƒ«æ“ä½œã®åŸºæœ¬çš„ãªçŸ¥è­˜
- macOSã¾ãŸã¯WSL2ï¼ˆUbuntuï¼‰ç’°å¢ƒ

---

## ðŸ³ Dockerã¨ã¯

### ã‚³ãƒ³ãƒ†ãƒŠæŠ€è¡“ã®åŸºç¤Ž

**Docker** ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãã®å®Ÿè¡Œç’°å¢ƒã‚’**ã‚³ãƒ³ãƒ†ãƒŠ**ã¨ã„ã†å˜ä½ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã™ã‚‹æŠ€è¡“ã§ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ãƒ›ã‚¹ãƒˆãƒžã‚·ãƒ³ï¼ˆã‚ãªãŸã®PCï¼‰        â”‚
â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Docker Engine             â”‚  â”‚
â”‚  â”‚                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ MySQL    â”‚ â”‚ Redis    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ ã‚³ãƒ³ãƒ†ãƒŠ  â”‚ â”‚ ã‚³ãƒ³ãƒ†ãƒŠ  â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- **ç’°å¢ƒã®å†ç¾æ€§**: ã©ã®PCã§ã‚‚åŒã˜ç’°å¢ƒã‚’æ§‹ç¯‰ã§ãã‚‹
- **ã‚¯ãƒªãƒ¼ãƒ³ãªç’°å¢ƒ**: ãƒ›ã‚¹ãƒˆãƒžã‚·ãƒ³ã‚’æ±šã•ãªã„ï¼ˆã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚‚ç°¡å˜ï¼‰
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: è¤‡æ•°ã®MySQLãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…±å­˜ã•ã›ã‚‰ã‚Œã‚‹
- **é–‹ç™ºã¨æœ¬ç•ªã®ç’°å¢ƒå·®ã‚’æ¸›ã‚‰ã›ã‚‹**: æœ¬ç•ªç’°å¢ƒã§ã‚‚Dockerã‚’ä½¿ã†ã‚±ãƒ¼ã‚¹ãŒå¤šã„

### Docker Composeã¨ã¯

**Docker Compose** ã¯ã€è¤‡æ•°ã®Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’ã¾ã¨ã‚ã¦ç®¡ç†ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

- **å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©**: `docker-compose.yml`ã«å…¨ã¦ã®è¨­å®šã‚’è¨˜è¿°
- **ã‚³ãƒžãƒ³ãƒ‰1ã¤ã§èµ·å‹•**: `docker compose up`ã§å…¨ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è‡ªå‹•æ§‹æˆ**: ã‚³ãƒ³ãƒ†ãƒŠé–“ã®é€šä¿¡ã‚’è‡ªå‹•è¨­å®š

**ä½¿ç”¨ä¾‹**:
- MySQL + Spring Boot + Redis
- PostgreSQL + Node.js + Nginx
- MongoDB + Python + RabbitMQ

---

## ðŸš€ ã‚¹ãƒ†ãƒƒãƒ—1: Docker Desktopã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### 1-1. macOSã®å ´åˆ

å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰Docker Desktopã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

**ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: [Docker Desktop for Mac](https://www.docker.com/products/docker-desktop/)

1. DMGãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. `Docker.app`ã‚’`Applications`ãƒ•ã‚©ãƒ«ãƒ€ã«ãƒ‰ãƒ©ãƒƒã‚°
3. Launchpadã‹ã‚‰ã€ŒDockerã€ã‚’èµ·å‹•
4. ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã«Dockerã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OK

**ç¢ºèª**:

```bash
docker --version
docker compose version
```

**æœŸå¾…ã•ã‚Œã‚‹çµæžœ**:

```
Docker version 24.0.x, build xxxxxx
Docker Compose version v2.23.x
```

### 1-2. WSL2ï¼ˆUbuntuï¼‰ã®å ´åˆ

WSL2ç’°å¢ƒã§ã¯ã€Windowså´ã«Docker Desktopã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€WSL2çµ±åˆã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚

**æ‰‹é †**:

1. **Docker Desktop for Windowsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   - [Docker Desktop for Windows](https://www.docker.com/products/docker-desktop/)ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’å®Ÿè¡Œ
   - ã€ŒUse WSL 2 instead of Hyper-Vã€ã«ãƒã‚§ãƒƒã‚¯

2. **Docker Desktopã‚’èµ·å‹•**
   - Windowsã®ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒDocker Desktopã€ã‚’èµ·å‹•
   - åˆå›žèµ·å‹•æ™‚ã«è¨­å®šã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€æŒ‡ç¤ºã«å¾“ã†

3. **WSL2çµ±åˆã‚’æœ‰åŠ¹åŒ–**
   - Docker Desktopã®è¨­å®šã‚’é–‹ãï¼ˆæ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ï¼‰
   - ã€ŒResourcesã€â†’ã€ŒWSL Integrationã€ã‚’é¸æŠž
   - ä½¿ç”¨ã—ã¦ã„ã‚‹Ubuntuãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–
   - ã€ŒApply & Restartã€ã‚’ã‚¯ãƒªãƒƒã‚¯

4. **WSL2ã®Ubuntuã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ç¢ºèª**

```bash
docker --version
docker compose version
```

**æœŸå¾…ã•ã‚Œã‚‹çµæžœ**:

```
Docker version 24.0.x, build xxxxxx
Docker Compose version v2.23.x
```

---

## ðŸš€ ã‚¹ãƒ†ãƒƒãƒ—2: docker-compose.ymlã®ä½œæˆ

### 2-1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

Phase 1ã§ä½œæˆã—ãŸ`hello-spring-boot`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`docker-compose.yml`ã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
cd /path/to/hello-spring-boot
```

**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `docker-compose.yml`

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: spring-boot-mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: spring_boot_db
      MYSQL_USER: springuser
      MYSQL_PASSWORD: springpass
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

volumes:
  mysql_data:
```

### 2-2. è¨­å®šã®è§£èª¬

#### `version: '3.8'`

Docker Composeãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã™ã€‚`3.8`ã¯åºƒãã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹å®‰å®šç‰ˆã§ã™ã€‚

#### `services:`

èµ·å‹•ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã®ãƒªã‚¹ãƒˆã‚’å®šç¾©ã—ã¾ã™ã€‚ä»Šå›žã¯`mysql`ã®ã¿ã§ã™ã€‚

#### `image: mysql:8.0`

ä½¿ç”¨ã™ã‚‹Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã¾ã™ã€‚

- `mysql`: å…¬å¼MySQLã‚¤ãƒ¡ãƒ¼ã‚¸
- `8.0`: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ï¼ˆæœ€æ–°ã®8.0ç³»ã‚’ä½¿ç”¨ï¼‰

#### `container_name: spring-boot-mysql`

ã‚³ãƒ³ãƒ†ãƒŠã«ä»˜ã‘ã‚‹åå‰ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã‚³ãƒžãƒ³ãƒ‰ã§ç‰¹å®šã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

#### `environment:`

ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚

| ç’°å¢ƒå¤‰æ•° | èª¬æ˜Ž | å€¤ |
|---|---|---|
| `MYSQL_ROOT_PASSWORD` | rootãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | `rootpassword` |
| `MYSQL_DATABASE` | åˆå›žèµ·å‹•æ™‚ã«ä½œæˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | `spring_boot_db` |
| `MYSQL_USER` | ä½œæˆã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å | `springuser` |
| `MYSQL_PASSWORD` | ä½œæˆã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | `springpass` |

#### `ports:`

ãƒ›ã‚¹ãƒˆå´ã¨ã‚³ãƒ³ãƒ†ãƒŠå´ã®ãƒãƒ¼ãƒˆã‚’ãƒžãƒƒãƒ”ãƒ³ã‚°ã—ã¾ã™ã€‚

```yaml
- "3306:3306"
```

- å·¦å´ï¼ˆ`3306`ï¼‰: ãƒ›ã‚¹ãƒˆå´ï¼ˆã‚ãªãŸã®PCï¼‰ã®ãƒãƒ¼ãƒˆ
- å³å´ï¼ˆ`3306`ï¼‰: ã‚³ãƒ³ãƒ†ãƒŠå´ã®ãƒãƒ¼ãƒˆ

ã“ã‚Œã«ã‚ˆã‚Šã€`localhost:3306`ã§MySQLã«æŽ¥ç¶šã§ãã¾ã™ã€‚

#### `volumes:`

ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ã‚’è¨­å®šã—ã¾ã™ã€‚

```yaml
volumes:
  - mysql_data:/var/lib/mysql
```

- `mysql_data`: DockerãŒç®¡ç†ã™ã‚‹ãƒœãƒªãƒ¥ãƒ¼ãƒ å
- `/var/lib/mysql`: ã‚³ãƒ³ãƒ†ãƒŠå†…ã®MySQLãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

**ãƒã‚¤ãƒ³ãƒˆ**:
ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ã—ã¦ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚

#### `command:`

MySQLã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¾ã™ã€‚

- `--character-set-server=utf8mb4`: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ–‡å­—ã‚»ãƒƒãƒˆ
- `--collation-server=utf8mb4_unicode_ci`: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç…§åˆé †åº

**ç†ç”±**:
çµµæ–‡å­—ã‚„å¤šè¨€èªžå¯¾å¿œã®ãŸã‚ã€`utf8mb4`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

---

## ðŸš€ ã‚¹ãƒ†ãƒƒãƒ—3: MySQLã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•

### 3-1. ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•

```bash
docker compose up -d
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³**:
- `up`: ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã¦èµ·å‹•
- `-d`: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œï¼ˆãƒ‡ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ï¼‰

**åˆå›žå®Ÿè¡Œæ™‚ã®å‡ºåŠ›ä¾‹**:

```
[+] Running 8/8
 â ¿ mysql Pulled
 â ¿ Container spring-boot-mysql  Started
```

**2å›žç›®ä»¥é™ã®å‡ºåŠ›ä¾‹**:

```
[+] Running 1/1
 â ¿ Container spring-boot-mysql  Started
```

### 3-2. ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ã‚’ç¢ºèª

```bash
docker compose ps
```

**æœŸå¾…ã•ã‚Œã‚‹çµæžœ**:

```
NAME                 IMAGE       COMMAND                  SERVICE   CREATED         STATUS         PORTS
spring-boot-mysql    mysql:8.0   "docker-entrypoint.sâ€¦"   mysql     2 minutes ago   Up 2 minutes   0.0.0.0:3306->3306/tcp, 33060/tcp
```

**STATUS**ãŒ`Up`ã«ãªã£ã¦ã„ã‚Œã°OKã§ã™ã€‚

### 3-3. ãƒ­ã‚°ã‚’ç¢ºèª

```bash
docker compose logs mysql
```

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã‚Œã°èµ·å‹•æˆåŠŸã§ã™:

```
mysql  | 2025-12-13T10:00:00.000000Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections.
```

---

## âœ… ã‚¹ãƒ†ãƒƒãƒ—4: MySQLã«æŽ¥ç¶š

### 4-1. ã‚³ãƒ³ãƒ†ãƒŠå†…ã§MySQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’èµ·å‹•

```bash
docker compose exec mysql mysql -u springuser -p
```

**ã‚³ãƒžãƒ³ãƒ‰è§£èª¬**:
- `docker compose exec mysql`: `mysql`ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
- `mysql -u springuser -p`: MySQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’èµ·å‹•ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å: `springuser`ï¼‰

**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›**: `springpass`

**æœŸå¾…ã•ã‚Œã‚‹çµæžœ**:

```
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 8
Server version: 8.0.35 MySQL Community Server - GPL

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>
```

### 4-2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèª

```sql
SHOW DATABASES;
```

**æœŸå¾…ã•ã‚Œã‚‹çµæžœ**:

```
+--------------------+
| Database           |
+--------------------+
| information_schema |
| performance_schema |
| spring_boot_db     |
+--------------------+
```

`spring_boot_db`ãŒä½œæˆã•ã‚Œã¦ã„ã‚Œã°OKã§ã™ã€‚

### 4-3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨

```sql
USE spring_boot_db;
```

**æœŸå¾…ã•ã‚Œã‚‹çµæžœ**:

```
Database changed
```

### 4-4. ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§ã‚’ç¢ºèª

```sql
SHOW TABLES;
```

**æœŸå¾…ã•ã‚Œã‚‹çµæžœ**ï¼ˆã¾ã ãƒ†ãƒ¼ãƒ–ãƒ«ãŒãªã„çŠ¶æ…‹ï¼‰:

```
Empty set (0.00 sec)
```

### 4-5. MySQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’çµ‚äº†

```sql
EXIT;
```

---

## ðŸ”§ ã‚¹ãƒ†ãƒƒãƒ—5: Docker Composeã®åŸºæœ¬æ“ä½œ

### 5-1. ã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢

```bash
docker compose stop
```

ã“ã‚Œã«ã‚ˆã‚Šã‚³ãƒ³ãƒ†ãƒŠã¯åœæ­¢ã—ã¾ã™ãŒã€å‰Šé™¤ã¯ã•ã‚Œã¾ã›ã‚“ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚‚ä¿æŒã•ã‚Œã¾ã™ï¼‰ã€‚

### 5-2. ã‚³ãƒ³ãƒ†ãƒŠã®å†èµ·å‹•

```bash
docker compose start
```

åœæ­¢ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•ã—ã¾ã™ã€‚

### 5-3. ã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢ã¨å‰Šé™¤

```bash
docker compose down
```

**æ³¨æ„**:
ã‚³ãƒ³ãƒ†ãƒŠã¯å‰Šé™¤ã•ã‚Œã¾ã™ãŒã€**ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒ**ã•ã‚Œã¾ã™ã€‚

### 5-4. ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚‚å«ã‚ã¦å®Œå…¨å‰Šé™¤

```bash
docker compose down -v
```

**è­¦å‘Š**:
`-v`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹ã¨ã€**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤**ã•ã‚Œã¾ã™ã€‚

### 5-5. ãƒ­ã‚°ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º

```bash
docker compose logs -f mysql
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³**:
- `-f`: ãƒ­ã‚°ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºï¼‰
- `Ctrl + C`ã§çµ‚äº†

---

## ðŸŽ¨ ã‚ªãƒ—ã‚·ãƒ§ãƒ³: MySQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«

ã‚³ãƒ³ãƒ†ãƒŠå†…ã®MySQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã ã‘ã§ãªãã€GUIãƒ„ãƒ¼ãƒ«ã§ã‚‚æŽ¥ç¶šã§ãã¾ã™ã€‚

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: MySQL Workbench

å…¬å¼ã®GUIãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

- **ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: [MySQL Workbench](https://dev.mysql.com/downloads/workbench/)
- **æŽ¥ç¶šæƒ…å ±**:
  - Hostname: `127.0.0.1`ï¼ˆã¾ãŸã¯`localhost`ï¼‰
  - Port: `3306`
  - Username: `springuser`
  - Password: `springpass`
  - Default Schema: `spring_boot_db`

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: DBeaver

ç„¡æ–™ã§å¤šæ©Ÿèƒ½ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã™ã€‚

- **ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: [DBeaver Community](https://dbeaver.io/download/)
- **å¯¾å¿œDB**: MySQL, PostgreSQL, SQLiteãªã©å¤šæ•°

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³3: VSCodeæ‹¡å¼µæ©Ÿèƒ½

VSCodeå†…ã§MySQLã‚’æ“ä½œã§ãã¾ã™ã€‚

**æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**:

1. VSCodeã®æ‹¡å¼µæ©Ÿèƒ½ã‚¿ãƒ–ã‚’é–‹ã
2. ã€ŒMySQLã€ã§æ¤œç´¢
3. ã€ŒMySQLã€ï¼ˆcweijanè£½ï¼‰ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**æŽ¥ç¶šè¨­å®š**:

1. ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã€ŒDATABASEã€ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€Œ+ã€ãƒœã‚¿ãƒ³ã§æ–°ã—ã„æŽ¥ç¶šã‚’è¿½åŠ 
3. æŽ¥ç¶šæƒ…å ±ã‚’å…¥åŠ›:
   - Host: `localhost`
   - Port: `3306`
   - Username: `springuser`
   - Password: `springpass`
   - Database: `spring_boot_db`

---

## ðŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "Cannot connect to the Docker daemon"

**åŽŸå› **: Docker DesktopãŒèµ·å‹•ã—ã¦ã„ãªã„

**è§£æ±ºç­–**:

- **macOS**: Docker Desktopã‚’èµ·å‹•ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã«ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼‰
- **WSL2**: Windowså´ã§Docker Desktopã‚’èµ·å‹•

ç¢ºèª:

```bash
docker ps
```

æ­£å¸¸ãªå ´åˆã€ã‚³ãƒ³ãƒ†ãƒŠä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

### ã‚¨ãƒ©ãƒ¼: "port is already allocated"

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:

```
Error response from daemon: driver failed programming external connectivity on endpoint spring-boot-mysql: 
Bind for 0.0.0.0:3306 failed: port is already allocated.
```

**åŽŸå› **: ãƒãƒ¼ãƒˆ3306ãŒæ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹

**è§£æ±ºç­–1**: æ—¢å­˜ã®MySQLã‚’åœæ­¢

```bash
# macOS
brew services stop mysql

# WSL2
sudo service mysql stop
```

**è§£æ±ºç­–2**: docker-compose.ymlã®ãƒãƒ¼ãƒˆç•ªå·ã‚’å¤‰æ›´

```yaml
ports:
  - "3307:3306"  # ãƒ›ã‚¹ãƒˆå´ã‚’3307ã«å¤‰æ›´
```

ã“ã®å ´åˆã€Spring Bootã®æŽ¥ç¶šè¨­å®šã‚‚`localhost:3307`ã«å¤‰æ›´ãŒå¿…è¦ã§ã™ã€‚

### ã‚¨ãƒ©ãƒ¼: "no configuration file provided"

**åŽŸå› **: `docker-compose.yml`ãŒãªã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œã—ã¦ã„ã‚‹

**è§£æ±ºç­–**:

```bash
# docker-compose.ymlãŒã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd /path/to/hello-spring-boot

# ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ã‚’ç¢ºèª
ls -la docker-compose.yml
```

### ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ãªã„

**ç¢ºèªã‚³ãƒžãƒ³ãƒ‰**:

```bash
docker compose logs mysql
```

**ã‚ˆãã‚ã‚‹åŽŸå› **:

1. **ãƒ¡ãƒ¢ãƒªä¸è¶³**: Docker Desktopã®ãƒ¡ãƒ¢ãƒªè¨­å®šã‚’å¢—ã‚„ã™
2. **YAMLæ§‹æ–‡ã‚¨ãƒ©ãƒ¼**: ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’ç¢ºèªï¼ˆã‚¹ãƒšãƒ¼ã‚¹2å€‹ï¼‰
3. **ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŽ¥ç¶šã‚’ç¢ºèª

### WSL2ã§Docker DesktopãŒèªè­˜ã•ã‚Œãªã„

**åŽŸå› **: WSL2çµ±åˆãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**:

1. Docker Desktop for Windowsã®è¨­å®šã‚’é–‹ã
2. ã€ŒResourcesã€â†’ã€ŒWSL Integrationã€
3. ä½¿ç”¨ã—ã¦ã„ã‚‹Ubuntuãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–
4. ã€ŒApply & Restartã€
5. WSL2ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’å†èµ·å‹•

### ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã¦ã—ã¾ã£ãŸ

**åŽŸå› **: `docker compose down -v`ã‚’å®Ÿè¡Œã—ãŸ

**å¯¾ç­–**:

- **é€šå¸¸ã®åœæ­¢**: `docker compose stop`ã‚’ä½¿ç”¨
- **ã‚³ãƒ³ãƒ†ãƒŠå‰Šé™¤æ™‚**: `docker compose down`ï¼ˆ`-v`ãªã—ï¼‰

**å¾©æ—§**:

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒãªã„å ´åˆã€ãƒ‡ãƒ¼ã‚¿ã¯å¾©æ—§ã§ãã¾ã›ã‚“ã€‚é‡è¦ãªãƒ‡ãƒ¼ã‚¿ã¯å®šæœŸçš„ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¾ã—ã‚‡ã†ã€‚

---

## ðŸ“š Docker Composeã®ä¾¿åˆ©ãªã‚³ãƒžãƒ³ãƒ‰

### ã‚ˆãä½¿ã†ã‚³ãƒžãƒ³ãƒ‰ä¸€è¦§

```bash
# èµ·å‹•ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
docker compose up -d

# åœæ­¢
docker compose stop

# èµ·å‹•
docker compose start

# å†èµ·å‹•
docker compose restart

# åœæ­¢ã—ã¦å‰Šé™¤
docker compose down

# ãƒ­ã‚°è¡¨ç¤ºï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰
docker compose logs -f

# ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ç¢ºèª
docker compose ps

# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒžãƒ³ãƒ‰å®Ÿè¡Œ
docker compose exec mysql bash

# ã‚¤ãƒ¡ãƒ¼ã‚¸ã®å†ãƒ“ãƒ«ãƒ‰
docker compose build

# æœ€æ–°ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾—ã—ã¦èµ·å‹•
docker compose pull
docker compose up -d
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

```bash
# ãƒ€ãƒ³ãƒ—ã‚’ä½œæˆ
docker compose exec mysql mysqldump -u springuser -pspringpass spring_boot_db > backup.sql

# ãƒªã‚¹ãƒˆã‚¢
docker compose exec -T mysql mysql -u springuser -pspringpass spring_boot_db < backup.sql
```

---

## ðŸ’¡ è£œè¶³: Dockerãƒœãƒªãƒ¥ãƒ¼ãƒ ã®ç®¡ç†

### ãƒœãƒªãƒ¥ãƒ¼ãƒ ä¸€è¦§ã®ç¢ºèª

```bash
docker volume ls
```

**æœŸå¾…ã•ã‚Œã‚‹çµæžœ**:

```
DRIVER    VOLUME NAME
local     hello-spring-boot_mysql_data
```

### ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®è©³ç´°æƒ…å ±

```bash
docker volume inspect hello-spring-boot_mysql_data
```

### ä½¿ç”¨ã—ã¦ã„ãªã„ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®å‰Šé™¤

```bash
docker volume prune
```

**è­¦å‘Š**:
ä½¿ç”¨ã—ã¦ã„ãªã„å…¨ã¦ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚

### ç‰¹å®šã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å‰Šé™¤

```bash
docker volume rm hello-spring-boot_mysql_data
```

**æ³¨æ„**:
ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹å ´åˆã¯å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚å…ˆã«`docker compose down`ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

---

## ðŸ“Š Dockerã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### é–‹ç™ºç’°å¢ƒã§ã®æŽ¨å¥¨è¨­å®š

1. **ãƒãƒ¼ãƒˆç•ªå·ã¯æ¨™æº–ã‚’ä½¿ç”¨**: `3306`ï¼ˆç«¶åˆæ™‚ã®ã¿å¤‰æ›´ï¼‰
2. **ãƒœãƒªãƒ¥ãƒ¼ãƒ åã¯æ˜Žç¤ºçš„ã«**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«åŒºåˆ¥ã—ã‚„ã™ã„åå‰
3. **ç’°å¢ƒå¤‰æ•°ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†**: `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ï¼ˆå¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ã§èª¬æ˜Žï¼‰
4. **ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’èª¿æ•´**: é–‹ç™ºæ™‚ã¯è©³ç´°ã€æœ¬ç•ªã¯æœ€å°é™

### æœ¬ç•ªç’°å¢ƒã¸ã®ç§»è¡Œ

Docker Composeã¯é–‹ç™ºç’°å¢ƒå‘ã‘ã§ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ä»¥ä¸‹ã‚’æ¤œè¨Žã—ã¦ãã ã•ã„ï¼š

- **Kubernetes**: ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- **Docker Swarm**: Dockerãƒã‚¤ãƒ†ã‚£ãƒ–ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°
- **ãƒžãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹**: AWS RDS, Google Cloud SQLãªã©

---

## âœ… æº–å‚™å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ä»¥ä¸‹ã‚’ã™ã¹ã¦ç¢ºèªã§ããŸã‚‰ã€Phase 2ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚€æº–å‚™å®Œäº†ã§ã™ï¼

- [ ] Docker DesktopãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ï¼ˆ`docker --version`ã§ç¢ºèªï¼‰
- [ ] Docker ComposeãŒä½¿ãˆã‚‹ï¼ˆ`docker compose version`ã§ç¢ºèªï¼‰
- [ ] `docker-compose.yml`ã‚’ä½œæˆã—ãŸ
- [ ] MySQLã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹ï¼ˆ`docker compose ps`ã§ç¢ºèªï¼‰
- [ ] `docker compose exec mysql mysql -u springuser -p`ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹`spring_boot_db`ãŒå­˜åœ¨ã™ã‚‹ï¼ˆ`SHOW DATABASES;`ã§ç¢ºèªï¼‰
- [ ] `docker compose stop`ã¨`docker compose start`ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’åˆ¶å¾¡ã§ãã‚‹

---

## âž¡ï¸ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ç’°å¢ƒæ§‹ç¯‰ãŒå®Œäº†ã—ãŸã‚‰ã€[Step 6: Spring Bootã¨MySQLã®æŽ¥ç¶š](STEP_6.md)ã¸é€²ã¿ã¾ã—ã‚‡ã†ï¼

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€Spring Bootãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰Dockerã‚³ãƒ³ãƒ†ãƒŠã§å‹•ä½œã—ã¦ã„ã‚‹MySQLã«æŽ¥ç¶šã—ã€æœ€åˆã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
