# Step 7: Spring Data JPAã§CRUDã®åŸºæœ¬

## ğŸ¯ ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ç›®æ¨™

- `@Entity`ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹
- `JpaRepository`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ç†è§£ã™ã‚‹
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆCreateï¼‰ã™ã‚‹
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆReadï¼‰ã™ã‚‹
- å®Ÿéš›ã«å‹•ä½œã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ä¸€è¦§å–å¾—APIã‚’å®Ÿè£…ã™ã‚‹

**æ‰€è¦æ™‚é–“**: ç´„1æ™‚é–“

---

## ğŸ“‹ äº‹å‰æº–å‚™

- Step 6ã§æ§‹ç¯‰ã—ãŸMySQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç’°å¢ƒ
- `spring-boot-starter-data-jpa`ã¨`mysql-connector-j`ã®ä¾å­˜é–¢ä¿‚ãŒè¿½åŠ æ¸ˆã¿

**Step 6ã‚’ã¾ã å®Œäº†ã—ã¦ã„ãªã„å ´åˆ**: [Step 6: MySQLç’°å¢ƒæ§‹ç¯‰](STEP_6.md)ã‚’å…ˆã«é€²ã‚ã¦ãã ã•ã„ã€‚

---

## ğŸ’¡ JPAã¨ã¯ï¼Ÿ

### JPA (Java Persistence API)

**JPA** = Javaã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã‚’è¡Œã†ãŸã‚ã®æ¨™æº–ä»•æ§˜

**ç‰¹å¾´**:
- âœ… SQLã‚’æ›¸ã‹ãªãã¦ã‚‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œãŒã§ãã‚‹
- âœ… ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ãˆã‚‹ï¼ˆORMï¼‰
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¨®é¡ã‚’å•ã‚ãªã„ï¼ˆMySQLã€PostgreSQLç­‰ï¼‰

### ORM (Object-Relational Mapping)

**Javaã®ã‚¯ãƒ©ã‚¹ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰** ã¨ **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ï¼‰** ã‚’å¯¾å¿œä»˜ã‘ã‚‹æŠ€è¡“

```
Javaã‚¯ãƒ©ã‚¹          â†â†’    ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«
-----------              -------------------
User.java                users ãƒ†ãƒ¼ãƒ–ãƒ«
â”œâ”€â”€ id                   â”œâ”€â”€ id (BIGINT)
â”œâ”€â”€ name                 â”œâ”€â”€ name (VARCHAR)
â””â”€â”€ email                â””â”€â”€ email (VARCHAR)
```

### Spring Data JPA

JPAã‚’ã•ã‚‰ã«ä½¿ã„ã‚„ã™ãã—ãŸSpringã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

**ä¾¿åˆ©ãªæ©Ÿèƒ½**:
- ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½œã‚‹ã ã‘ã§CRUDæ“ä½œãŒä½¿ãˆã‚‹
- ãƒ¡ã‚½ãƒƒãƒ‰åã‹ã‚‰è‡ªå‹•çš„ã«ã‚¯ã‚¨ãƒªã‚’ç”Ÿæˆ
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ãŒç°¡å˜

---

## ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—1: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¯ãƒ©ã‚¹ã®ä½œæˆ

### 1-1. Userã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ä½œæˆ

æ–°ã—ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸`entity`ã‚’ä½œæˆã—ã€`User`ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚

**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `src/main/java/com/example/hellospringboot/entity/User.java`

```java
package com.example.hellospringboot.entity;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Entity
@Table(name = "users")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, length = 100)
    private String name;

    @Column(nullable = false, unique = true, length = 100)
    private String email;

    @Column
    private Integer age;
}
```

### 1-2. ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®è§£èª¬

#### `@Entity`
```java
@Entity
```
- ã“ã®ã‚¯ãƒ©ã‚¹ãŒJPAã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾å¿œã™ã‚‹ã‚¯ãƒ©ã‚¹

#### `@Table`
```java
@Table(name = "users")
```
- ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’æŒ‡å®šï¼ˆçœç•¥æ™‚ã¯ã‚¯ãƒ©ã‚¹åãŒä½¿ã‚ã‚Œã‚‹ï¼‰
- `User` â†’ `user`ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãªã‚‹ãŒã€æ˜ç¤ºçš„ã«`users`ã¨æŒ‡å®š

#### `@Id`
```java
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)
private Long id;
```
- `@Id`: ä¸»ã‚­ãƒ¼ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™
- `@GeneratedValue`: å€¤ã®è‡ªå‹•ç”Ÿæˆ
- `GenerationType.IDENTITY`: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è‡ªå‹•æ¡ç•ªæ©Ÿèƒ½ã‚’ä½¿ç”¨

#### `@Column`
```java
@Column(nullable = false, length = 100)
private String name;

@Column(nullable = false, unique = true, length = 100)
private String email;
```
- `nullable = false`: NOT NULLåˆ¶ç´„
- `unique = true`: ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ï¼ˆé‡è¤‡ä¸å¯ï¼‰
- `length = 100`: VARCHAR(100)

### 1-3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•ã¨ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¾ã™ã€‚

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ãªSQLãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```sql
Hibernate: 
    create table users (
       id bigint generated by default as identity,
        age integer,
        email varchar(100) not null,
        name varchar(100) not null,
        primary key (id)
    )
Hibernate: 
    alter table if exists users 
       add constraint UK_6dotkott2kjsp8vw4d0m25fb7 unique (email)
```

**ã“ã‚Œã§è‡ªå‹•çš„ã«ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼**

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¢ºèªæ–¹æ³•ï¼š**

**DBeaverï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªDBãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ï¼‰**
- ç„¡æ–™ã§å¤šæ©Ÿèƒ½ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ãƒ„ãƒ¼ãƒ«
- [https://dbeaver.io/](https://dbeaver.io/)
- MySQLã€PostgreSQLãªã©å¤šæ•°ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾å¿œ
- æ¥ç¶šæƒ…å ±: Host `localhost`, Port `3306`, Database `hellospringboot`, User `dbuser`, Password `dbpassword`

**MySQL CLI**
```bash
docker exec -it spring-boot-mysql mysql -udbuser -pdbpassword hellospringboot
```

> **ğŸ’¡ ãƒ’ãƒ³ãƒˆ**: å®Ÿå‹™ã§ã¯DBeaverãªã©ã®å°‚ç”¨ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã“ã¨ãŒå¤šã„ã§ã™

---

## ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—2: ãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆ

### 2-1. UserRepositoryã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ä½œæˆ

æ–°ã—ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸`repository`ã‚’ä½œæˆã—ã€`UserRepository`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚

**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `src/main/java/com/example/hellospringboot/repository/UserRepository.java`

```java
package com.example.hellospringboot.repository;

import com.example.hellospringboot.entity.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    // ãƒ¡ã‚½ãƒƒãƒ‰ã¯è‡ªå‹•çš„ã«æä¾›ã•ã‚Œã‚‹ï¼ˆã¾ã ä½•ã‚‚æ›¸ã‹ãªã„ï¼‰
}
```

### 2-2. ã‚³ãƒ¼ãƒ‰ã®è§£èª¬

#### `JpaRepository<User, Long>`
```java
public interface UserRepository extends JpaRepository<User, Long>
```
- `User`: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å‹
- `Long`: ä¸»ã‚­ãƒ¼ï¼ˆIDï¼‰ã®å‹

#### è‡ªå‹•çš„ã«æä¾›ã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰

`JpaRepository`ã‚’ç¶™æ‰¿ã™ã‚‹ã ã‘ã§ã€ä»¥ä¸‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒä½¿ãˆã¾ã™ï¼š

| ãƒ¡ã‚½ãƒƒãƒ‰ | æ©Ÿèƒ½ |
|---------|------|
| `save(entity)` | ä¿å­˜ï¼ˆInsert/Updateï¼‰ |
| `findById(id)` | IDã§æ¤œç´¢ |
| `findAll()` | å…¨ä»¶å–å¾— |
| `deleteById(id)` | IDã§å‰Šé™¤ |
| `count()` | ä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆ |
| `existsById(id)` | å­˜åœ¨ãƒã‚§ãƒƒã‚¯ |

**ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ï¼**

---

## ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—3: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®ä½œæˆ

### 3-1. UserServiceã®ä½œæˆ

æ–°ã—ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸`service`ã‚’ä½œæˆã—ã€`UserService`ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚

**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `src/main/java/com/example/hellospringboot/service/UserService.java`

```java
package com.example.hellospringboot.service;

import com.example.hellospringboot.entity.User;
import com.example.hellospringboot.repository.UserRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
@RequiredArgsConstructor
public class UserService {

    private final UserRepository userRepository;

    /**
     * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
     */
    public User createUser(User user) {
        return userRepository.save(user);
    }

    /**
     * å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
     */
    public List<User> getAllUsers() {
        return userRepository.findAll();
    }
}
```

### 3-2. ã‚³ãƒ¼ãƒ‰ã®è§£èª¬

#### `@Service`
```java
@Service
```
- ã“ã®ã‚¯ãƒ©ã‚¹ãŒã‚µãƒ¼ãƒ“ã‚¹å±¤ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™
- Spring BootãŒè‡ªå‹•çš„ã«Beanã¨ã—ã¦ç™»éŒ²

#### `@RequiredArgsConstructor` (Lombok)
```java
@RequiredArgsConstructor
public class UserService {
    private final UserRepository userRepository;
```
- `final`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å¼•æ•°ã«æŒã¤ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è‡ªå‹•ç”Ÿæˆ
- ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰ã«ä½¿ç”¨

**Lombokãªã—ã§æ›¸ãã¨**:
```java
public class UserService {
    private final UserRepository userRepository;
    
    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
}
```

---

## ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—4: ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ä½œæˆ

### 4-1. Phase 1ã®DTOã‚’å‰Šé™¤ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

Phase 1ã§ä½œæˆã—ãŸ`UserRequest`ã¨`UserResponse`ã¯ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨æ§‹é€ ãŒç•°ãªã‚‹ãŸã‚ã€
ä»Šå›ã¯ç›´æ¥ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½¿ç”¨ã—ã¾ã™ï¼ˆå¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ã§DTOã‚’å†å°å…¥ã—ã¾ã™ï¼‰ã€‚

### 4-2. UserControllerã®ä½œæˆï¼ˆæ–°è¦ï¼‰

Phase 1ã®`UserController`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«**æ›¸ãæ›ãˆ**ã¾ã™ã€‚

**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `src/main/java/com/example/hellospringboot/controller/UserController.java`

```java
package com.example.hellospringboot.controller;

import com.example.hellospringboot.entity.User;
import com.example.hellospringboot.service.UserService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/users")
@RequiredArgsConstructor
public class UserController {

    private final UserService userService;

    /**
     * ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
     * POST /api/users
     */
    @PostMapping
    public ResponseEntity<User> createUser(@RequestBody User user) {
        User createdUser = userService.createUser(user);
        return ResponseEntity.status(HttpStatus.CREATED).body(createdUser);
    }

    /**
     * å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—
     * GET /api/users
     */
    @GetMapping
    public ResponseEntity<List<User>> getAllUsers() {
        List<User> users = userService.getAllUsers();
        return ResponseEntity.ok(users);
    }
}
```

### 4-3. ã‚³ãƒ¼ãƒ‰ã®è§£èª¬

#### `@RequestMapping("/api/users")`
```java
@RequestMapping("/api/users")
```
- ã“ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯`/api/users`ã§å§‹ã¾ã‚‹
- RESTful APIã®æ…£ç¿’ã«å¾“ã†

#### `ResponseEntity<T>`
```java
public ResponseEntity<User> createUser(@RequestBody User user) {
    User createdUser = userService.createUser(user);
    return ResponseEntity.status(HttpStatus.CREATED).body(createdUser);
}
```
- HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ãƒœãƒ‡ã‚£ã‚’æ˜ç¤ºçš„ã«è¿”ã›ã‚‹
- `HttpStatus.CREATED` â†’ 201 Created
- `ResponseEntity.ok()` â†’ 200 OK

---

## âœ… ã‚¹ãƒ†ãƒƒãƒ—5: å‹•ä½œç¢ºèª

### 5-1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¾ã™ã€‚

### 5-2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼ˆPOSTï¼‰

```bash
curl -X POST http://localhost:8080/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Taro Yamada",
    "email": "taro@example.com",
    "age": 30
  }'
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
```json
{
  "id": 1,
  "name": "Taro Yamada",
  "email": "taro@example.com",
  "age": 30
}
```

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã¯å®Ÿè¡Œã•ã‚ŒãŸSQLãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```sql
Hibernate: 
    insert 
    into
        users
        (age, email, name) 
    values
        (?, ?, ?)
```

### 5-3. ã•ã‚‰ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ 

```bash
curl -X POST http://localhost:8080/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Hanako Tanaka",
    "email": "hanako@example.com",
    "age": 25
  }'

curl -X POST http://localhost:8080/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Jiro Suzuki",
    "email": "jiro@example.com",
    "age": 28
  }'
```

### 5-4. å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ï¼ˆGETï¼‰

```bash
curl http://localhost:8080/api/users
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
```json
[
  {
    "id": 1,
    "name": "Taro Yamada",
    "email": "taro@example.com",
    "age": 30
  },
  {
    "id": 2,
    "name": "Hanako Tanaka",
    "email": "hanako@example.com",
    "age": 25
  },
  {
    "id": 3,
    "name": "Jiro Suzuki",
    "email": "jiro@example.com",
    "age": 28
  }
]
```

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®SQLï¼š

```sql
Hibernate: 
    select
        u1_0.id,
        u1_0.age,
        u1_0.email,
        u1_0.name 
    from
        users u1_0
```

### 5-5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ç¢ºèª

**DBeaverã¾ãŸã¯MySQL CLIã§ç¢ºèª:**

1. ãƒ„ãƒ¼ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹/æ¥ç¶š
2. ä»¥ä¸‹ã®SQLã‚’å®Ÿè¡Œï¼š

```sql
SELECT * FROM users;
```

**çµæœ**: ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

---

## ğŸ¨ ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šæ€§ã‚’ç¢ºèª

### å®Ÿé¨“: ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ç¢ºèª

1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’**åœæ­¢**
2. å†åº¦**èµ·å‹•**
3. `curl http://localhost:8080/api/users`ã‚’å®Ÿè¡Œ

**çµæœ**: ãƒ‡ãƒ¼ã‚¿ãŒæ®‹ã£ã¦ã„ã¾ã™ï¼

**ç†ç”±**: MySQLã¯ãƒ‡ã‚£ã‚¹ã‚¯ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã€å†èµ·å‹•ã—ã¦ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒæ°¸ç¶šåŒ–ã•ã‚Œã¾ã™ã€‚


---

## ğŸ¨ ãƒãƒ£ãƒ¬ãƒ³ã‚¸èª²é¡Œ

### ãƒãƒ£ãƒ¬ãƒ³ã‚¸ 1: é‡è¤‡ãƒ¡ãƒ¼ãƒ«ç™»éŒ²ã®å‹•ä½œç¢ºèª

åŒã˜ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§2å›ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¦ã¿ã¦ãã ã•ã„ã€‚

```bash
curl -X POST http://localhost:8080/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test User",
    "email": "test@example.com",
    "age": 20
  }'

# ã‚‚ã†ä¸€åº¦åŒã˜ãƒ¡ãƒ¼ãƒ«ã§ç™»éŒ²
curl -X POST http://localhost:8080/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Another User",
    "email": "test@example.com",
    "age": 25
  }'
```

**æœŸå¾…ã•ã‚Œã‚‹æŒ™å‹•**: ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿï¼ˆ`unique constraint`é•åï¼‰

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å­¦ã³ã¾ã™ã€‚**

### ãƒãƒ£ãƒ¬ãƒ³ã‚¸ 2: Productã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ä½œæˆ

å•†å“ã‚’ç®¡ç†ã™ã‚‹`Product`ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

**è¦ä»¶**:
- ãƒ†ãƒ¼ãƒ–ãƒ«å: `products`
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰:
  - `id` (Long, ä¸»ã‚­ãƒ¼, è‡ªå‹•ç”Ÿæˆ)
  - `name` (String, NOT NULL, æœ€å¤§100æ–‡å­—)
  - `price` (Integer, NOT NULL)
  - `category` (String, æœ€å¤§50æ–‡å­—)

**ãƒ’ãƒ³ãƒˆ**:
1. `Product.java`ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½œæˆ
2. `ProductRepository.java`ã‚’ä½œæˆ
3. `ProductService.java`ã‚’ä½œæˆ
4. `ProductController.java`ã‚’ä½œæˆ

### ãƒãƒ£ãƒ¬ãƒ³ã‚¸ 3: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’è¿”ã™API

ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç·æ•°ã‚’è¿”ã™ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/users/count`

**ãƒ’ãƒ³ãƒˆ**:
```java
// UserService
public long countUsers() {
    return userRepository.count();
}

// UserController
@GetMapping("/count")
public ResponseEntity<Long> countUsers() {
    long count = userService.countUsers();
    return ResponseEntity.ok(count);
}
```

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### "Table 'users' not found"

**åŸå› **: ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**:
1. `User`ã‚¯ãƒ©ã‚¹ã«`@Entity`ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹ã‹ç¢ºèª
2. `application.yml`ã§`ddl-auto: update`ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†èµ·å‹•

### "No property 'xxx' found for type 'User'"

**åŸå› **: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¯ãƒ©ã‚¹ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚„GetterãŒãªã„

**è§£æ±ºç­–**:
- Lombokã®`@Data`ã¾ãŸã¯`@Getter`ãŒä»˜ã„ã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®ã‚¹ãƒšãƒ«ãƒŸã‚¹ãŒãªã„ã‹ç¢ºèª

### "Could not write JSON: Infinite recursion"

**åŸå› **: å¾ªç’°å‚ç…§ï¼ˆæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§æ‰±ã†ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã§ç™ºç”Ÿã—ã‚„ã™ã„ï¼‰

**è§£æ±ºç­–**: ä»Šã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ç™ºç”Ÿã—ã¾ã›ã‚“ãŒã€æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

### POSTã§"Unsupported Media Type"

**åŸå› **: `Content-Type: application/json`ãƒ˜ãƒƒãƒ€ãƒ¼ãŒãªã„

**è§£æ±ºç­–**:
```bash
curl -X POST http://localhost:8080/api/users \
  -H "Content-Type: application/json" \  # ã“ã‚Œã‚’å¿˜ã‚Œãšã«
  -d '{"name":"Test","email":"test@example.com","age":20}'
```

### IDãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œãªã„

**ç—‡çŠ¶**: IDãŒå¸¸ã«nullã¾ãŸã¯0

**åŸå› **: `@GeneratedValue`ãŒãªã„

**è§£æ±ºç­–**:
```java
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)  // ã“ã‚Œã‚’è¿½åŠ 
private Long id;
```

---

## ğŸ“š ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å­¦ã‚“ã ã“ã¨

- âœ… `@Entity`ã§ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©
- âœ… `@Table`, `@Id`, `@GeneratedValue`, `@Column`ã®ä½¿ã„æ–¹
- âœ… `JpaRepository`ã‚’ç¶™æ‰¿ã—ã¦ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆ
- âœ… `save()`ã§ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã€`findAll()`ã§å…¨ä»¶å–å¾—
- âœ… ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢
- âœ… ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§RESTful APIã‚’å®Ÿè£…
- âœ… `ResponseEntity`ã§HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’åˆ¶å¾¡
- âœ… HibernateãŒè‡ªå‹•çš„ã«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã™ã‚‹ä»•çµ„ã¿

---

## ğŸ’¡ è£œè¶³: JPAã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

### ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®çŠ¶æ…‹

JPAã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã¯çŠ¶æ…‹ãŒã‚ã‚Šã¾ã™ï¼š

```
æ–°è¦ä½œæˆ â†’ æ°¸ç¶šåŒ– â†’ åˆ†é›¢ â†’ å‰Šé™¤
(New)    (Managed) (Detached) (Removed)
```

#### Newï¼ˆæ–°è¦ï¼‰
```java
User user = new User();
user.setName("Taro");
// ã¾ã ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã¦ã„ãªã„
```

#### Managedï¼ˆæ°¸ç¶šåŒ–ï¼‰
```java
User savedUser = userRepository.save(user);
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã€JPAãŒç®¡ç†ã—ã¦ã„ã‚‹
```

#### Detachedï¼ˆåˆ†é›¢ï¼‰
```java
// ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯åˆ†é›¢çŠ¶æ…‹
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã®åŒæœŸãŒåˆ‡ã‚Œã‚‹
```

#### Removedï¼ˆå‰Šé™¤ï¼‰
```java
userRepository.delete(user);
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å‰Šé™¤ã•ã‚Œã‚‹
```

**Step 9ã§è©³ã—ãå­¦ã³ã¾ã™ã€‚**

---

## ğŸ’¡ è£œè¶³: ãªãœRepositoryã¨Serviceã‚’åˆ†ã‘ã‚‹ã®ã‹ï¼Ÿ

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åˆ†é›¢

```
Controllerå±¤ï¼ˆUserControllerï¼‰
    â†“ APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚‹
Serviceå±¤ï¼ˆUserServiceï¼‰
    â†“ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè¡Œ
Repositoryå±¤ï¼ˆUserRepositoryï¼‰
    â†“ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹
Databaseï¼ˆMySQLï¼‰
```

### ãƒ¡ãƒªãƒƒãƒˆ

1. **è²¬å‹™ã®åˆ†é›¢**
   - Controller: HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†
   - Service: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
   - Repository: ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹

2. **ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„**
   - Serviceã ã‘ã‚’ãƒ†ã‚¹ãƒˆå¯èƒ½
   - Repositoryã‚’ãƒ¢ãƒƒã‚¯ã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹

3. **å†åˆ©ç”¨æ€§**
   - åŒã˜Serviceã‚’è¤‡æ•°ã®Controllerã‹ã‚‰ä½¿ç”¨å¯èƒ½

**Step 13ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼åŒ–ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ·±ãå­¦ã³ã¾ã™ã€‚**

---

## ğŸ”„ Gitã¸ã®ã‚³ãƒŸãƒƒãƒˆã¨ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼

é€²æ—ã‚’è¨˜éŒ²ã—ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å—ã‘ã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m "Step 7: Spring Data JPAã§CRUDåŸºæœ¬å®Ÿè£…å®Œäº†"
git push origin main
```

ã‚³ãƒŸãƒƒãƒˆå¾Œã€**Slackã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼**ã‚’å‡ºã—ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ã‚‚ã‚‰ã„ã¾ã—ã‚‡ã†ï¼

---

## â¡ï¸ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå®Œäº†ã—ãŸã‚‰ã€[Step 8: CRUDæ“ä½œã®å®Œæˆ](STEP_8.md)ã¸é€²ã¿ã¾ã—ã‚‡ã†ï¼

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€Updateï¼ˆæ›´æ–°ï¼‰ã¨Deleteï¼ˆå‰Šé™¤ï¼‰æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã€
å®Œå…¨ãªCRUDæ“ä½œã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã¾ãŸã€IDã§ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—ã™ã‚‹æ©Ÿèƒ½ã‚‚è¿½åŠ ã—ã¾ã™ï¼

---

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ ğŸ‰

SQLã‚’æ›¸ã‹ãšã«ã€Javaã®ã‚³ãƒ¼ãƒ‰ã ã‘ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œãŒã§ãã¾ã—ãŸï¼
ã“ã‚ŒãŒJPAã®å¼·åŠ›ãªæ©Ÿèƒ½ã§ã™ã€‚æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§CRUDã‚’å®Œæˆã•ã›ã¾ã—ã‚‡ã†ï¼
